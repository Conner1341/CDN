---

copyright:
  years: 2017
lastupdated: "2017-09-11"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:download: .download}

# CDN の管理

CDN 構成の管理方法を以下のガイドラインで説明します。
 
## CDN を実行状態にする

CDN を作成すると、CDN ダッシュボードにそれが表示されます。ここには、CDN の名前、オリジン、プロバイダー、状況が示されます。  

 ![マッピング・リストのスクリーン・ショット](images/mapping_list_cname.png)

1. CDN を注文したら、DNS プロバイダーで **CNAME** を構成する必要があります。ほとんどの DNS プロバイダーは、CNAME の設定または変更の手順を提供しています。
   
   * この期間中、CDN の状況は**「CNAME 構成 (CNAME Configuration)」**と表示されます。変更がいつアクティブになるかを、DNS プロバイダーに確認してください。

   ![CNAME 構成](images/cname-config.png)  
   
2. DNS プロバイダーで CNAME を構成したらいつでも、CDN の状況の右側にあるオーバーフロー・メニューから**「状況の取得 (Get Status)」**を選択して、状況をチェックできます。
   
  ![CNAME getStatus](images/cname-getstatus.png)  
    
3. CNAME のチェーニングが完了すると、アカウントの状況が*「実行中」* に変わり、CDN は使用可能な状態になります。
   	  
これで、CDN は実行しています。  
	  
## CDN の停止
CDN の停止は、状況が「実行中」のときにのみ行えます。 

1. オーバーフロー・メニュー (CDN 状況の右側にある縦の 3 つのドット) から「CDN の停止 (Stop CDN)」をクリックします。
 ![オーバーフロー・メニュー](images/stop_cdn.png)

2. サービス開始の確認を求める大きめのダイアログ・ウィンドウが表示されます。**「確認」**を選択して続行します。
  
3. およそ 5 秒から 15 秒後に、状況が「停止 (Stopped)」に変わります。


## CDN の開始
CDN の開始は、状況が「停止 (Stopped)」のときにのみ行えます。
1. オーバーフロー・メニュー (CDN 行の右側に 3 つのドットとして表示される) から「CDN の開始 (Start CDN)」をクリックします。
  ![オーバーフロー・メニュー](images/start_cdn.png)


2. サービス開始の確認を求める大きめのダイアログ・ウィンドウが表示されます。**「確認」**を選択して続行します。

3. アクションが成功すると、画面の右上隅にダイアログ・ボックスが表示され、成功したこととその時間を知らせます。
  
4. これにより、状況が「CNAME 構成 (CNAME Configuration)」に変わります。

5. オーバーフロー・メニューから「状況の取得 (Get Status)」をクリックします。これにより、状況が「実行中」に変わります。CDN は作動可能になります。

## CDN の削除

CDN を削除するには、以下のステップを実行します。
**注**: オーバーフロー・メニューから`「削除」`を選択すると、CDN のみが削除されます。ご使用のアカウントは削除されません。

1. オーバーフロー・メニューから「削除」をクリックします。

 ![CDN の削除のオーバーフロー・メニュー](images/delete_cdn.png)

2. 削除の確認を求める大きめのダイアログ・ウィンドウが表示されます。**「削除」**をクリックして続行します。

3. これにより、状況が「削除中」に変わります。オーバーフロー・メニューから「状況の取得 (Get Status)」をクリックします。これにより、この行が CDN リストから削除されます。

## 「存続時間」を使用したコンテンツ・キャッシング時間の設定

CDN が実行中になった後、存続時間 (TTL) を使用してコンテンツ・キャッシング時間を設定できます。特定のファイルまたはディレクトリー・パスの存続時間は、そのコンテンツをキャッシュに入れる時間の長さを示します。CDN マッピングを作成した場合、デフォルト・グローバル TTL の 3600 秒が作成されています。 

1. CDN ページで、CDN を選択します。これにより、**「概要」**ページに移動します。

2. 矢印を使用して、または新しい時間を入力することで、時間を調整できます。時間値は秒単位で指定します。例えば、3600 秒は 1 時間に相当します。`timeToLive` に選択可能な最小値は 30 秒で、最大値は 21474836471 秒です。**「保存」**ボタンを選択すると、コンテンツ・キャッシング時間が設定されます。 

  ![TTL の追加](images/adding-path.png)

3. 保存したら、オーバーフロー・メニュー・オプションを使用して、TTL 設定の**「編集」**または**「削除」**を行えます。(**注**: TTL のパスは変更できません。マッピング・パスが変更されると、TTL パスが自動的に更新されます。)

  ![TTL の編集または削除](images/edit-delete-ttl-setting.png)  
	
  * コンテンツが複数のルールに一致する場合は、最も新しく追加された構成が優先されます。
  
  * TTL 値は、特定のファイル名またはディレクトリー対してのみ設定可能です。正規表現は、予測不能の振る舞いを生成する可能性があるため、サポートされません。
	
## オリジン・パスの詳細の追加

CDN の状況が*「CNAME 構成」* または*「実行中」* の場合、オリジン・パスの詳細を追加できます。複数のオリジン・サーバーからのコンテンツの提供を選択できます。例えば、ビデオとは異なるサーバーから、写真を配信することができます。オリジンは、ホスト・サーバーまたはオブジェクト・ストレージをベースとすることができます。

1. CDN ページで、CDN を選択します。これにより、**「概要」**ページに移動します。
	
2. **「オリジン (Origins)」**タブを選択し、**「オリジンの追加 (Add Origin)」** ボタンを選択します。
	
3. *必ず*、パスを指定してください。**「サーバー」**または**「オブジェクト・ストレージ」**のいずれかを選択します。
	
   ![オリジン、オリジンの追加](images/add-origin.png)
		
  * **「サーバー」**を選択したら、サーバー IP アドレスまたは_ホスト名_ を入力します。CDN の作成中に選択したプロトコルに応じて、HTTP ポートまたは HTTPS ポート、あるいはその両方を指定します。これはそのマッピングに一致する必要があります。
	
  ![オリジン・サーバーの追加](images/add-origin-server.png)
	
  * **「オブジェクト・ストレージ」**を選択した場合は、エンドポイント、バケット名、および HTTPS ポートを指定します。オプションで、CDN サービスで使用できるファイル拡張子を指定します。何も指定しないと、すべてのファイル拡張子が許可されます。
	
  ![オリジンのオブジェクト・ストレージの追加](images/add-origin-object-storage.png)
		
4. **「追加」**ボタンを選択して、オリジン・パスを追加します。

  **注**: オブジェクト・ストレージのオリジン・パスにファイル拡張子を指定すると、オリジン・パスと同じ URL を持つ TTL 設定の有効範囲が、これらの指定されたファイル拡張子を持つすべてのファイルになります。例えば、オリジン・パス "/example" を作成し、ファイル拡張子 "jpg png gif" を指定すると、TTL パス "/example" の TTL 値は、"/example" ディレクトリーとそのサブディレクトリーにあるすべての JPG/PNG/GIF ファイルが有効範囲となります。

5. 追加したら、オーバーフロー・メニュー・オプションを使用して、オリジンの**「編集」**または**「削除」**を行えます。

  ![オリジンの編集または削除](images/edit-delete-origin.png)
	
## キャッシュ・コンテンツのパージ

CDN が実行中になった後、ベンダーのサーバーからキャッシュ・コンテンツをパージできます。  

1. CDN ページで、CDN を選択します。これにより、**「概要」**ページに移動します。
	
2. **「パージ (Purge)」**タブを選択します。

	![「パージ (Purge)」ページ](images/purge_tab.png)
	
3. パージするファイルを示した標準の UNIX パス構文を入力し、**「パージ (Purge)」**ボタンを選択します。現時点では、単一ファイルのパージのみが可能です。

4. パージすると、このアクティビティーが**「パージ・アクティビティー (Purge Activity)」**の下にリストされます。オーバーフロー・メニュー・オプションを使用して、**「パージの再実行 (Redo purge)」**、またはパスの**「お気に入り (Favorite)」**の登録を行えます。

	![パージ・アクティビティー](images/purge-activity.png)
	
   **注:** 15 を超えるパージがある場合、パージ・アクティビティーは 15 日ごとに自動的に削減されます。
	
## CDN 構成の詳細の更新

CDN が実行中になった後、CDN 構成の詳細を更新できます。

1. CDN ページで、CDN を選択します。これにより、**「概要」**ページに移動します。

2. **「設定」**タブを選択します。CDN 構成の詳細が表示されます。

  **「オブジェクト・ストレージ」**の場合、以下のフィールドを変更できます。 
   * エンドポイント
   * バケット名
   * HTTPS ポート
   * 許可されるファイル拡張子
   * 失効コンテンツの提供 (Serve Stale Content)
   * ヘッダーを尊重 (Respect Headers)

  **「サーバー」**の場合、以下のフィールドを変更できます。 
   * オリジン・サーバー・アドレス
   * HTTP/HTTPS ポート
   * 失効コンテンツの提供 (Serve Stale Content)
   * ヘッダーを尊重 (Respect Headers)

3. 必要であれば、**「オリジン (Origin)」**または**「その他のオプション (Other Options)」**の詳細を更新し、右下隅の**「保存」**ボタンをクリックして、CDN 構成の詳細を更新します。

   ![「保存」ボタン](images/save-button.png)


## CDN に関する IBM Cloud Object Storage の構成

IBM Cloud Object Storage に保管されたオブジェクトを利用するには、バケット内の各オブジェクトについて「acl」プロパティー (つまり、アクセス制御リスト) の値を "public-read" のアクセス権限に設定する必要があります。 

必要なクライアントまたはツールをインストールするには、IBM Cloud Object Storage Developer Center (https://developer.ibm.com/cloudobjectstorage/) の「Tools」セクションを参照してください。このガイドでは、IBM Cloud Object Storage S3 API と互換の公式 AWS コマンド・ライン・インターフェースがインストールされていることを前提としています。

以下のサンプル・コードは、コマンド・ライン・インターフェースを使用して、バケット内のすべてのオブジェクトに "public-read" のアクセス権限を設定する方法を示しています。

```
$ export ENDPOINT="YOUR_ENDPOINT"
$ export BUCKET="YOUR_BUCKET"
$ KEYS=( "$(aws --endpoint-url "$ENDPOINT" s3api list-objects --no-paginate --query 'Contents[].{key: Key}' --output text --bucket "$BUCKET")" )
$ for KEY in "${KEYS[@]}"
  > do
  >   aws --endpoint-url "$ENDPOINT" s3api put-object-acl --bucket "$BUCKET" --key "$KEY" --acl "public-read"
  > done
```
